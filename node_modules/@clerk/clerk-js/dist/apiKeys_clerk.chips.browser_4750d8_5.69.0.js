"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["616"],{2010:function(e,t,i){i.r(t),i.d(t,{APIKeys:()=>L,APIKeysPage:()=>A});var a=i(9109),l=i(3531),n=i(3799),o=i(9144),r=i(903),s=i(1576),c=i(9541),d=i(9805),u=i(2672),h=i(1319),p=i(3638),y=i(4174),m=i(1201),x=i(9626),g=i(3009),Z=i(2464),K=i(2156);let b=({apiKeyID:e,enabled:t})=>{let i=(0,n.cL)();return(0,x.default)(t?["api-key-secret",e]:null,()=>i.apiKeys.getSecret(e))},v=({apiKeyID:e})=>{let[t,i]=(0,o.useState)(!1),{data:l}=b({apiKeyID:e,enabled:t}),{onCopy:n,hasCopied:r}=(0,Z.VP)(l??"");return(0,o.useEffect)(()=>{t&&l&&(n(),i(!1))},[t,l,n]),(0,a.tZ)(c.Button,{variant:"ghost","aria-label":r?"Copied API key to clipboard":"Copy API key",onClick:()=>i(!0),focusRing:!1,children:(0,a.tZ)(c.Icon,{size:"sm",icon:r?y.Jr:y.uU,sx:e=>({color:e.colors.$primary500})})})},f=({apiKeyID:e})=>{let[t,i]=(0,o.useState)(!1),{data:l}=b({apiKeyID:e,enabled:t});return(0,a.BX)(c.Flex,{center:!0,sx:{width:"100%",position:"relative"},children:[(0,a.tZ)(c.Input,{type:t?"text":"password",value:t&&l?l:`â€¢`.repeat(25),readOnly:!0,"aria-label":"API key (hidden)",sx:e=>({paddingInlineEnd:e.sizes.$12})}),(0,a.tZ)(c.Button,{variant:"ghost",sx:e=>({position:"absolute",right:0,"&:focus-visible":{...m.common.focusRingStyles(e)}}),focusRing:!1,"aria-label":"Show key",onClick:()=>i(!t),children:(0,a.tZ)(c.Icon,{icon:t?y.N6:y.bA,sx:e=>({color:e.colors.$colorTextSecondary})})})]})},w=({rows:e,isLoading:t,onRevoke:i})=>(0,a.tZ)(c.Flex,{sx:e=>({width:"100%",[m.mqu.sm]:{overflowX:"auto",padding:e.space.$0x25}}),children:(0,a.BX)(c.Table,{sx:e=>({background:e.colors.$colorBackground}),children:[(0,a.tZ)(c.Thead,{children:(0,a.BX)(c.Tr,{children:[(0,a.tZ)(c.Th,{children:"Name"}),(0,a.tZ)(c.Th,{children:"Last used"}),(0,a.tZ)(c.Th,{children:"Key"}),(0,a.tZ)(c.Th,{children:"Actions"})]})}),(0,a.tZ)(c.Tbody,{children:t?(0,a.tZ)(c.Tr,{children:(0,a.tZ)(c.Td,{colSpan:4,children:(0,a.tZ)(c.Spinner,{colorScheme:"primary",sx:{margin:"auto",display:"block"},elementDescriptor:c.descriptors.spinner})})}):e.length?e.map(e=>(0,a.BX)(c.Tr,{children:[(0,a.tZ)(c.Td,{children:(0,a.BX)(c.Flex,{direction:"col",sx:{minWidth:"25ch"},children:[(0,a.tZ)(c.Text,{variant:"subtitle",truncate:!0,children:e.name}),(0,a.BX)(c.Text,{variant:"caption",colorScheme:"secondary",children:["Created at"," ",e.createdAt.toLocaleDateString(void 0,{month:"short",day:"2-digit",year:"numeric"})]})]})}),(0,a.tZ)(c.Td,{children:(0,a.tZ)(c.Box,{sx:{[m.mqu.sm]:{minWidth:"10ch"}},children:(0,a.tZ)(c.Text,{localizationKey:e.lastUsedAt?(0,K.S)(e.lastUsedAt):"-"})})}),(0,a.tZ)(c.Td,{children:(0,a.BX)(c.Flex,{direction:"row",gap:1,sx:{[m.mqu.sm]:{minWidth:"25ch"}},children:[(0,a.tZ)(f,{apiKeyID:e.id}),(0,a.tZ)(v,{apiKeyID:e.id})]})}),(0,a.tZ)(c.Td,{children:(0,a.tZ)(g.a,{actions:[{label:(0,c.localizationKeys)("apiKeys.menuAction__revoke"),isDestructive:!0,onClick:()=>i(e.id,e.name)}]})})]},e.id)):(0,a.tZ)(T,{})})]})}),T=()=>(0,a.tZ)(c.Tr,{children:(0,a.tZ)(c.Td,{colSpan:4,children:(0,a.tZ)(c.Text,{localizationKey:(0,c.localizationKeys)("apiKeys.detailsTitle__emptyRow"),sx:{margin:"auto",display:"block",width:"fit-content"}})})});var k=i(4709),I=i(431),B=i(9460),C=i(8487),_=i(7291),S=i(6788);let D=(e,t)=>{if("never"===e)return;let i=new Date,a=new Date(i);switch(e){case"30d":a.setDate(a.getDate()+30);break;case"90d":a.setDate(a.getDate()+90);break;case"custom":a=new Date(t);break;default:throw Error("Invalid expiration option")}return Math.floor((a.getTime()-i.getTime())/1e3)},z=()=>{let e=new Date;return e.setDate(e.getDate()+1),e.toISOString().split("T")[0]},F=({onCreate:e,isSubmitting:t})=>{let[i,l]=(0,o.useState)(!1),[n,r]=(0,o.useState)("never"),s=o.useId(),d=`${s}-segmented-control`,{close:u}=(0,k.XC)(),h=(0,S.Yp)("name","",{type:"text",label:(0,c.localizationKeys)("formFieldLabel__apiKeyName"),placeholder:(0,c.localizationKeys)("formFieldInputPlaceholder__apiKeyName"),isRequired:!0}),p=(0,S.Yp)("apiKeyDescription","",{type:"text",label:(0,c.localizationKeys)("formFieldLabel__apiKeyDescription"),placeholder:(0,c.localizationKeys)("formFieldInputPlaceholder__apiKeyDescription"),isRequired:!1}),y=(0,S.Yp)("apiKeyExpirationDate","",{type:"date",label:(0,c.localizationKeys)("formFieldLabel__apiKeyExpirationDate"),placeholder:(0,c.localizationKeys)("formFieldInputPlaceholder__apiKeyExpirationDate"),isRequired:!1}),x=h.value.length>2;return(0,a.tZ)(C.Y,{headerTitle:(0,c.localizationKeys)("apiKeys.formTitle"),headerSubtitle:(0,c.localizationKeys)("apiKeys.formHint"),children:(0,a.BX)(I.l.Root,{onSubmit:t=>{t.preventDefault(),e({name:h.value,description:p.value||void 0,expiration:D(n,y.value)},u)},children:[(0,a.tZ)(I.l.ControlRow,{elementId:h.id,children:(0,a.tZ)(I.l.PlainInput,{...h.props})}),i&&(0,a.BX)(a.HY,{children:[(0,a.tZ)(I.l.ControlRow,{elementId:p.id,children:(0,a.tZ)(I.l.PlainInput,{...p.props})}),(0,a.BX)(c.Flex,{gap:4,sx:{[m.mqu.sm]:{flexDirection:"column"}},children:[(0,a.BX)(c.Col,{gap:2,sx:{flex:7},children:[(0,a.tZ)(c.FormLabel,{htmlFor:d,children:(0,a.tZ)(c.Text,{as:"span",variant:"subtitle",localizationKey:(0,c.localizationKeys)("formFieldLabel__apiKeyExpiration")})}),(0,a.BX)(_.s.Root,{"aria-labelledby":d,value:n,onChange:e=>r(e),fullWidth:!0,sx:e=>({height:e.sizes.$8}),children:[(0,a.tZ)(_.s.Button,{value:"never",text:"Never"}),(0,a.tZ)(_.s.Button,{value:"30d",text:"30 days"}),(0,a.tZ)(_.s.Button,{value:"90d",text:"90 days"}),(0,a.tZ)(_.s.Button,{value:"custom",text:"Custom"})]})]}),"custom"===n?(0,a.tZ)(I.l.ControlRow,{elementId:y.id,sx:{flex:3},children:(0,a.tZ)(I.l.PlainInput,{type:"date",...y.props,min:z()})}):(0,a.tZ)(c.Box,{sx:{flex:3,visibility:"hidden"}})]})]}),(0,a.BX)(c.Flex,{justify:"between",align:"center",gap:4,sx:{[m.mqu.sm]:{flexDirection:"column",alignItems:"stretch"}},children:[(0,a.BX)(c.Button,{variant:"outline",onClick:()=>l(e=>!e),children:[i?"Hide":"Show"," advanced settings"]}),(0,a.tZ)(B.A,{submitLabel:(0,c.localizationKeys)("apiKeys.formButtonPrimary__add"),isDisabled:!x,onReset:u,isLoading:t})]})]})})},P=({subject:e,perPage:t=5})=>{let i=(0,n.cL)(),a={key:"api-keys",subject:e},{data:l,isLoading:r,mutate:s}=(0,x.default)(a,()=>i.apiKeys.getAll({subject:e})),[c,d]=(0,o.useState)(""),{page:u,setPage:h,pageCount:p,itemCount:y,startingRow:m,endingRow:g,paginatedItems:Z}=R((l??[]).filter(e=>e.name.toLowerCase().includes(c.toLowerCase())),t);return{apiKeys:Z,cacheKey:a,mutate:s,isLoading:r,search:c,setSearch:d,page:u,setPage:h,pageCount:p,itemCount:y,startingRow:m,endingRow:g}},R=(e,t)=>{let[i,a]=(0,o.useState)(1),l=e.length,n=Math.max(1,Math.ceil(l/t)),r=l>0?(i-1)*t+1:0,s=Math.min(i*t,l),c=e.slice(r-1,s);return{page:i,setPage:a,pageCount:n,itemCount:l,startingRow:r,endingRow:s,paginatedItems:c}},X=(0,o.lazy)(()=>i.e("642").then(i.bind(i,3250)).then(e=>({default:e.RevokeAPIKeyConfirmationModal}))),A=({subject:e,perPage:t,revokeModalRoot:i})=>{let{apiKeys:s,isLoading:x,search:g,setSearch:Z,page:K,setPage:b,pageCount:v,itemCount:f,startingRow:T,endingRow:k,cacheKey:I}=P({subject:e,perPage:t}),B=(0,u.useCardState)(),{trigger:C,isMutating:_}=(0,r.Z)(I,(e,{arg:t})=>D.apiKeys.create(t)),{t:S}=(0,c.useLocalizations)(),D=(0,n.cL)(),[z,R]=(0,o.useState)(!1),[A,L]=(0,o.useState)(""),[q,E]=(0,o.useState)(""),$=async(t,i)=>{try{await C({...t,subject:e}),i(),B.setError(void 0)}catch(e){(0,l.kD)(e)&&409===e.status&&B.setError("API Key name already exists")}};return(0,a.BX)(c.Col,{gap:4,sx:{width:"100%"},children:[(0,a.BX)(d.a.Root,{children:[(0,a.BX)(c.Flex,{justify:"between",align:"center",gap:4,sx:{[m.mqu.sm]:{flexDirection:"column",alignItems:"stretch"}},children:[(0,a.tZ)(c.Box,{children:(0,a.tZ)(h.W,{placeholder:S((0,c.localizationKeys)("apiKeys.action__search")),leftIcon:(0,a.tZ)(c.Icon,{icon:y.Yt}),value:g,onChange:e=>{Z(e.target.value),b(1)}})}),(0,a.tZ)(d.a.Trigger,{value:"add-api-key",hideOnActive:!1,children:(0,a.tZ)(c.Button,{variant:"solid",localizationKey:(0,c.localizationKeys)("apiKeys.action__add")})})]}),(0,a.tZ)(d.a.Open,{value:"add-api-key",children:(0,a.tZ)(c.Flex,{sx:e=>({paddingTop:e.space.$6,paddingBottom:e.space.$6}),children:(0,a.tZ)(d.a.Card,{sx:{width:"100%"},children:(0,a.tZ)(F,{onCreate:$,isSubmitting:_})})})})]}),(0,a.tZ)(w,{rows:s,isLoading:x,onRevoke:(e,t)=>{L(e),E(t),R(!0)}}),f>(t??5)&&(0,a.tZ)(p.t,{count:v,page:K,onChange:b,siblingCount:1,rowInfo:{allRowsCount:f,startingRow:T,endingRow:k}}),(0,a.tZ)(X,{subject:e,isOpen:z,onOpen:()=>R(!0),onClose:()=>{L(""),E(""),R(!1)},apiKeyId:A,apiKeyName:q,modalRoot:i})]})},L=(0,s.withCoreUserGuard)((0,u.withCardStateProvider)(()=>{let e=(0,s.useApiKeysContext)(),{user:t}=(0,n.aF)(),{organization:i}=(0,n.o8)(),l=i?.id??t?.id??"";return(0,a.tZ)(c.Flow.Root,{flow:"apiKeys",sx:{width:"100%"},children:(0,a.tZ)(A,{subject:l,perPage:e.perPage})})}))}}]);