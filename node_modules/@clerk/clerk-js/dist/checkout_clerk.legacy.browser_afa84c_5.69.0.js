"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["237"],{10670:function(e,t,o){o.r(t),o.d(t,{Checkout:()=>Y});var r=o(79109),i=o(81102),n=o(11576),a=o(39541);o(65223);var l=o(69144),c=o(28e3),s=o(73003),d=o(12464),u=o(24676),m=o(77623);o(92037);var p=o(83799),h=o(69626),y=o(50903);let f=(0,l.createContext)(null),g=()=>{let e=(0,l.useContext)(f);if(!e)throw Error("CheckoutContextRoot not found");return e},v=()=>{let{planId:e,planPeriod:t,subscriberType:o="user",onSubscriptionComplete:r}=(0,n.useCheckoutContext)(),i=(0,p.cL)(),{organization:a}=(0,p.o8)(),{user:c}=(0,p.aF)(),s={key:"commerce-checkout",userId:null==c?void 0:c.id,arguments:{..."org"===o?{orgId:null==a?void 0:a.id}:{},planId:e,planPeriod:t}},{data:d,mutate:u}=(0,h.default)(s),{trigger:m,isMutating:f,error:g}=(0,y.Z)(s,e=>{var t;return null===(t=i.billing)||void 0===t?void 0:t.startCheckout(e.arguments)},{throwOnError:!1,onSuccess:e=>{u(e,!1)}});return(0,l.useEffect)(()=>(m(),()=>{u(void 0,!1)}),[]),{checkout:d,startCheckout:m,updateCheckout:e=>{u(e,!1),null==r||r()},isMutating:f,errors:null==g?void 0:g.errors}},k=e=>{let{children:t}=e,{checkout:o,isMutating:i,updateCheckout:n,errors:a,startCheckout:c}=v(),s=(0,l.useMemo)(()=>{var e;if(i)return"pending";let t="completed";if((null==o?void 0:o.status)===t)return t;if(o)return"ready";let r="missing_payer_email";if(null==a?void 0:a.some(e=>e.code===r))return r;let n="invalid_plan_change";return(null==a?void 0:null===(e=a[0])||void 0===e?void 0:e.code)===n?n:"error"},[i,a,o,null==o?void 0:o.status]);return(0,r.tZ)(f.Provider,{value:{checkout:o,isLoading:i,updateCheckout:n,errors:a,startCheckout:c,status:s},children:t})},x=e=>{let{children:t,name:o}=e;return g().status!==o?null:t},b=e=>e[0].toUpperCase()+e.slice(1),S=(e,t,o)=>e+(t-e)*o,Z=()=>{let e=(0,u.useRouter)(),{setIsOpen:t}=(0,i.useDrawerContext)(),{newSubscriptionRedirectUrl:o}=(0,n.useCheckoutContext)(),{checkout:p}=g(),[h,y]=(0,l.useState)({x:256,y:256}),[f,v]=(0,l.useState)({x:256,y:256}),k=(0,d.Tb)(),{animations:x}=(0,a.useAppearance)().parsedLayout,Z=!k&&!0===x,B=(0,l.useRef)(null),w=(0,l.useRef)(null),C="undefined"==typeof window||window.matchMedia("(hover: hover) and (pointer: fine)").matches;return((0,l.useEffect)(()=>{if(!C)return;let e=()=>{v(e=>({x:S(e.x,h.x,.15),y:S(e.y,h.y,.15)})),B.current=requestAnimationFrame(e)};return B.current=requestAnimationFrame(e),()=>{B.current&&cancelAnimationFrame(B.current)}},[h,C]),p)?(0,r.BX)(r.HY,{children:[(0,r.tZ)(i.Drawer.Body,{children:(0,r.BX)(a.Span,{elementDescriptor:a.descriptors.checkoutSuccessRoot,sx:e=>({"--ring-fill":e.colors.$neutralAlpha200,"--ring-highlight":e.colors.$success500,margin:"auto",position:"relative",aspectRatio:"1/1",display:"grid",width:"100%",padding:e.space.$4,flexShrink:0,transformOrigin:"bottom center",animationName:"scaleIn",animationDuration:"".concat(s.bf.slowest,"ms"),animationTimingFunction:s.$$.bezier,animationFillMode:"forwards",opacity:0,overflow:"hidden",backgroundColor:e.colors.$colorBackground,"@keyframes scaleIn":{"0%":{filter:"blur(10px)",transform:"scale(0.85)",opacity:0},"100%":{filter:"blur(0px)",transform:"scale(1)",opacity:1}},...!Z&&{animation:"none",opacity:1}}),ref:w,onMouseMove:e=>{if(C&&w.current){let t=w.current.getBoundingClientRect(),o=e.clientX-t.left,r=e.clientY-t.top,i=t.width;i>0?y({x:o/i*512,y:r/i*512}):y({x:256,y:256})}},children:[(0,r.BX)(a.Box,{elementDescriptor:a.descriptors.checkoutSuccessRings,as:"svg",viewBox:"0 0 512 512",sx:{position:"absolute",inset:0,pointerEvents:"none"},"aria-hidden":!0,children:[(0,r.BX)("defs",{children:[(0,r.BX)("radialGradient",{id:"clerk-checkout-success-gradient",children:[(0,r.tZ)("stop",{offset:"0%",style:{stopColor:"var(--ring-highlight)"}}),(0,r.tZ)("stop",{offset:"100%",stopOpacity:"0",style:{stopColor:"var(--ring-highlight)"}})]}),(0,r.tZ)("filter",{id:"clerk-checkout-success-blur-effect",children:(0,r.tZ)("feGaussianBlur",{stdDeviation:"10"})}),(0,r.tZ)("mask",{id:"clerk-checkout-success-mask",children:[{r:225,maskStart:10,maskEnd:90},{r:162.5,maskStart:15,maskEnd:85},{r:100,maskStart:20,maskEnd:80}].map(e=>{let{r:t,maskStart:o,maskEnd:i}=e;return(0,r.tZ)("circle",{cx:"256",cy:"256",r:t,stroke:"white",fill:"none",style:{maskImage:"linear-gradient(to bottom, transparent ".concat(o,"%, black, transparent ").concat(i,"%)")}},t)})})]}),(0,r.BX)("g",{mask:"url(#clerk-checkout-success-mask)",children:[(0,r.tZ)("rect",{width:"512",height:"512",style:{fill:"var(--ring-fill)"}}),C&&(0,r.tZ)("rect",{id:"movingGradientHighlight",width:"256",height:"256",x:f.x-128,y:f.y-128,fill:"url(#clerk-checkout-success-gradient)",filter:"url(#clerk-checkout-success-blur-effect)"})]})]}),(0,r.BX)(a.Box,{elementDescriptor:a.descriptors.checkoutSuccessBadge,sx:e=>({margin:"auto",gridArea:"1/1",display:"flex",position:"relative",width:e.sizes.$16,height:e.sizes.$16,borderRadius:e.radii.$circle,backgroundImage:"linear-gradient(180deg, rgba(255, 255, 255, 0.30) 0%, rgba(0, 0, 0, 0.12) 50%, rgba(0, 0, 0, 0.30) 95.31%)",boxShadow:"0px 4px 12px 0px rgba(0, 0, 0, 0.35), 0px 1px 0px 0px rgba(255, 255, 255, 0.05) inset",color:C?e.colors.$success500:e.colors.$colorText,":before":{content:'""',position:"absolute",inset:e.space.$1,borderRadius:e.radii.$circle,backgroundColor:e.colors.$colorBackground}}),children:[(0,r.tZ)("svg",{fill:"none",viewBox:"0 0 10 10","aria-hidden":"true",style:{position:"relative",margin:"auto",width:"1rem",height:"1rem"},children:(0,r.tZ)("path",{d:"m1 6 3 3 5-8",stroke:"currentColor",strokeWidth:"1.25",strokeLinecap:"round",strokeLinejoin:"round",strokeDasharray:"1",pathLength:"1",style:{strokeDashoffset:"1",animation:Z?"check ".concat(s.bf.drawer,"ms ").concat(s.$$.bezier," forwards ").concat(s.bf.slow,"ms"):"none",...!Z&&{strokeDashoffset:"0"}}})}),(0,r.tZ)("style",{children:"\n              @keyframes check {\n                0% {\n                  stroke-dashoffset: 1;\n                }\n                100% {\n                  stroke-dashoffset: 0;\n                }\n            "})]}),(0,r.BX)(a.Span,{sx:e=>({margin:"auto",gridArea:"1/1",position:"relative",textAlign:"center",transform:"translateY(".concat(e.space.$20,")")}),children:[(0,r.tZ)(a.Heading,{elementDescriptor:a.descriptors.checkoutSuccessTitle,as:"h2",textVariant:"h2",localizationKey:p.totals.totalDueNow.amount>0?(0,a.localizationKeys)("commerce.checkout.title__paymentSuccessful"):(0,a.localizationKeys)("commerce.checkout.title__subscriptionSuccessful"),sx:e=>({opacity:0,animationName:"slideUp",animationDuration:"".concat(s.bf.slowest,"ms"),animationTimingFunction:s.$$.bezier,animationFillMode:"forwards",color:e.colors.$colorText,"@keyframes slideUp":{"0%":{transform:"translateY(30px)",opacity:0},"100%":{transform:"translateY(0)",opacity:1}},...!Z&&{opacity:1,animation:"none"}})}),(0,r.tZ)(a.Text,{elementDescriptor:a.descriptors.checkoutSuccessDescription,colorScheme:"secondary",sx:e=>({textAlign:"center",paddingInline:e.space.$8,marginBlockStart:e.space.$2,opacity:0,animationName:"slideUp",animationDuration:"".concat(1.5*s.bf.slowest,"ms"),animationTimingFunction:s.$$.bezier,animationFillMode:"forwards","@keyframes slideUp":{"0%":{transform:"translateY(30px)",opacity:0},"100%":{transform:"translateY(0)",opacity:1}},...!Z&&{opacity:1,animation:"none"}}),localizationKey:p.totals.totalDueNow.amount>0?(0,a.localizationKeys)("commerce.checkout.description__paymentSuccessful"):(0,a.localizationKeys)("commerce.checkout.description__subscriptionSuccessful")})]})]})}),(0,r.BX)(i.Drawer.Footer,{sx:e=>({rowGap:e.space.$4,animationName:"footerSlideInUp",animationDuration:"".concat(s.bf.drawer,"ms"),animationTimingFunction:s.$$.bezier,"@keyframes footerSlideInUp":{"0%":{transform:"translateY(100%)",opacity:0},"100%":{transform:"translateY(0)",opacity:1}},...!Z&&{animation:"none"}}),children:[(0,r.BX)(c.a.Root,{children:[(0,r.BX)(c.a.Group,{variant:"secondary",children:[(0,r.tZ)(c.a.Title,{title:(0,a.localizationKeys)("commerce.checkout.lineItems.title__totalPaid")}),(0,r.tZ)(c.a.Description,{text:"".concat(p.totals.totalDueNow.currencySymbol).concat(p.totals.totalDueNow.amountFormatted)})]}),(0,r.BX)(c.a.Group,{variant:"secondary",children:[(0,r.tZ)(c.a.Title,{title:p.totals.totalDueNow.amount>0?(0,a.localizationKeys)("commerce.checkout.lineItems.title__paymentMethod"):(0,a.localizationKeys)("commerce.checkout.lineItems.title__subscriptionBegins")}),(0,r.tZ)(c.a.Description,{text:p.totals.totalDueNow.amount>0?p.paymentSource?"card"!==p.paymentSource.paymentMethod?"".concat(b(p.paymentSource.paymentMethod)):"".concat(b(p.paymentSource.cardType)," ⋯ ").concat(p.paymentSource.last4):"–":p.planPeriodStart?(0,m.p6)(new Date(p.planPeriodStart)):"–"})]})]}),(0,r.tZ)(a.Button,{onClick:()=>{o&&e.navigate(o),t&&t(!1)},localizationKey:(0,a.localizationKeys)("formButtonPrimary")})]})]}):null};var B=o(44455),w=o(2672),C=o(47291),D=o(3146),_=o(19732),z=o(22189),$=o(96519),K=o(8057),P=o(57106);let A=e=>e[0].toUpperCase()+e.slice(1),R=(0,w.withCardStateProvider)(()=>{var e,t,o,n,l,s;let{checkout:d}=g();if(!d)return null;let{plan:u,planPeriod:m,totals:p,isImmediatePlanChange:h}=d,y=!!(null===(e=p.credit)||void 0===e?void 0:e.amount)&&p.credit.amount>0,f=!!(null===(t=p.pastDue)||void 0===t?void 0:t.amount)&&p.pastDue.amount>0;return(0,r.BX)(i.Drawer.Body,{children:[(0,r.tZ)(a.Box,{elementDescriptor:a.descriptors.checkoutFormLineItemsRoot,sx:e=>({padding:e.space.$4,borderBottomWidth:e.borderWidths.$normal,borderBottomStyle:e.borderStyles.$solid,borderBottomColor:e.colors.$neutralAlpha100}),children:(0,r.BX)(c.a.Root,{children:[(0,r.BX)(c.a.Group,{children:[(0,r.tZ)(c.a.Title,{title:u.name,description:"annual"===m?(0,a.localizationKeys)("commerce.billedAnnually"):void 0}),(0,r.tZ)(c.a.Description,{prefix:"annual"===m?"x12":void 0,text:"".concat(u.currencySymbol).concat("month"===m?u.amountFormatted:u.annualMonthlyAmountFormatted),suffix:(0,a.localizationKeys)("commerce.checkout.perMonth")})]}),(0,r.BX)(c.a.Group,{borderTop:!0,variant:"tertiary",children:[(0,r.tZ)(c.a.Title,{title:(0,a.localizationKeys)("commerce.subtotal")}),(0,r.tZ)(c.a.Description,{text:"".concat(p.subtotal.currencySymbol).concat(p.subtotal.amountFormatted)})]}),y&&(0,r.BX)(c.a.Group,{variant:"tertiary",children:[(0,r.tZ)(c.a.Title,{title:(0,a.localizationKeys)("commerce.creditRemainder")}),(0,r.tZ)(c.a.Description,{text:"- ".concat(null===(o=p.credit)||void 0===o?void 0:o.currencySymbol).concat(null===(n=p.credit)||void 0===n?void 0:n.amountFormatted)})]}),f&&(0,r.BX)(c.a.Group,{variant:"tertiary",children:[(0,r.BX)(_.u.Root,{children:[(0,r.tZ)(_.u.Trigger,{children:(0,r.tZ)(c.a.Title,{title:(0,a.localizationKeys)("commerce.pastDue"),icon:$.I$})}),(0,r.tZ)(_.u.Content,{text:(0,a.localizationKeys)("commerce.checkout.pastDueNotice")})]}),(0,r.tZ)(c.a.Description,{text:"".concat(null===(l=p.pastDue)||void 0===l?void 0:l.currencySymbol).concat(null===(s=p.pastDue)||void 0===s?void 0:s.amountFormatted)})]}),(0,r.BX)(c.a.Group,{borderTop:!0,children:[(0,r.tZ)(c.a.Title,{title:(0,a.localizationKeys)("commerce.totalDueToday")}),(0,r.tZ)(c.a.Description,{text:"".concat(p.totalDueNow.currencySymbol).concat(p.totalDueNow.amountFormatted)})]})]})}),!h&&(0,r.tZ)(a.Box,{elementDescriptor:a.descriptors.checkoutFormLineItemsRoot,sx:e=>({paddingBlockStart:e.space.$4,paddingInline:e.space.$4}),children:(0,r.tZ)(a.Text,{localizationKey:(0,a.localizationKeys)("commerce.checkout.downgradeNotice"),variant:"caption",colorScheme:"secondary"})}),(0,r.tZ)(F,{checkout:d})]})}),T=()=>{let{organization:e}=(0,p.o8)(),{subscriberType:t}=(0,n.useCheckoutContext)(),{updateCheckout:o,checkout:r}=g(),i=(0,w.useCardState)();if(!r)throw Error("Checkout not found");let a=async n=>{i.setLoading(),i.setError(void 0);try{let i=await r.confirm({...n,..."org"===t?{orgId:null==e?void 0:e.id}:{}});o(i)}catch(e){(0,m.S3)(e,[],i.setError)}finally{i.setIdle()}};return{payWithExistingPaymentSource:async o=>{o.preventDefault();let r=new FormData(o.currentTarget).get("payment_source_id");await a({paymentSourceId:r,..."org"===t?{orgId:null==e?void 0:e.id}:{}})},addPaymentSourceAndPay:async o=>{var r;await a({gateway:"stripe",paymentToken:null===(r=o.stripeSetupIntent)||void 0===r?void 0:r.payment_method,..."org"===t?{orgId:null==e?void 0:e.id}:{}})},payWithTestCard:async()=>{i.setLoading(),i.setError(void 0);try{let i=await r.confirm({gateway:"stripe",useTestCard:!0,..."org"===t?{orgId:null==e?void 0:e.id}:{}});o(i)}catch(e){(0,m.S3)(e,[],i.setError)}finally{i.setIdle()}}}},F=e=>{let{checkout:t}=e,{data:o}=(0,n.usePaymentSources)(),{data:i}=o||{data:[]},[c,s]=(0,l.useState)(()=>i.length>0?"existing":"new");return(0,r.BX)(a.Col,{elementDescriptor:a.descriptors.checkoutFormElementsRoot,gap:4,sx:e=>({padding:e.space.$4}),children:[i.length>0&&t.totals.totalDueNow.amount>0&&(0,r.BX)(C.s.Root,{"aria-label":"Payment method source",value:c,onChange:e=>s(e),size:"lg",fullWidth:!0,children:[(0,r.tZ)(C.s.Button,{value:"existing",text:(0,a.localizationKeys)("commerce.paymentMethods")}),(0,r.tZ)(C.s.Button,{value:"new",text:(0,a.localizationKeys)("commerce.addPaymentMethod")})]}),"existing"===c&&(0,r.tZ)(E,{checkout:t,paymentSources:i,totalDueNow:t.totals.totalDueNow}),"new"===c&&(0,r.tZ)(I,{})]})},X=()=>{let{isLoading:e}=(0,w.useCardState)(),{payWithTestCard:t}=T();return(0,r.BX)(a.Box,{sx:e=>({background:e.colors.$neutralAlpha50,padding:e.space.$2x5,borderRadius:e.radii.$md,borderWidth:e.borderWidths.$normal,borderStyle:e.borderStyles.$solid,borderColor:e.colors.$neutralAlpha100,display:"flex",flexDirection:"column",rowGap:e.space.$2,position:"relative"}),children:[(0,r.tZ)(a.Box,{sx:e=>({position:"absolute",inset:0,background:"repeating-linear-gradient(-45deg,".concat(e.colors.$warningAlpha100,",").concat(e.colors.$warningAlpha100," 6px,").concat(e.colors.$warningAlpha150," 6px,").concat(e.colors.$warningAlpha150," 12px)"),maskImage:"linear-gradient(transparent 20%, black)",pointerEvents:"none"})}),(0,r.BX)(a.Flex,{sx:e=>({alignItems:"center",justifyContent:"center",flexDirection:"column",rowGap:e.space.$2}),children:[(0,r.tZ)(a.Text,{sx:e=>({color:e.colors.$warning500,fontWeight:e.fontWeights.$semibold}),localizationKey:(0,a.localizationKeys)("commerce.paymentSource.dev.developmentMode")}),(0,r.tZ)(a.Button,{type:"button",block:!0,variant:"bordered",localizationKey:(0,a.localizationKeys)("userProfile.billingPage.paymentSourcesSection.payWithTestCardButton"),colorScheme:"secondary",isLoading:e,onClick:t})]})]})},I=(0,w.withCardStateProvider)(()=>{let{addPaymentSourceAndPay:e}=T(),{checkout:t}=g();return t?(0,r.BX)(K.fC,{onSuccess:e,checkout:t,children:[(0,r.tZ)(z.P,{children:(0,r.tZ)(X,{})}),t.totals.totalDueNow.amount>0?(0,r.tZ)(K.OL,{text:(0,a.localizationKeys)("commerce.pay",{amount:"".concat(t.totals.totalDueNow.currencySymbol).concat(t.totals.totalDueNow.amountFormatted)})}):(0,r.tZ)(K.OL,{text:(0,a.localizationKeys)("commerce.subscribe")})]}):null}),E=(0,w.withCardStateProvider)(e=>{let{checkout:t,totalDueNow:o,paymentSources:i}=e,{payWithExistingPaymentSource:n}=T(),c=(0,w.useCardState)(),[s,d]=(0,l.useState)(t.paymentSource||i.find(e=>e.isDefault)),u=(0,l.useMemo)(()=>i.map(e=>{let t="card"!==e.paymentMethod?"".concat(A(e.paymentMethod)):"".concat(A(e.cardType)," ⋯ ").concat(e.last4);return{value:e.id,label:t}}),[i]);return(0,r.BX)(a.Form,{onSubmit:n,sx:e=>({display:"flex",flexDirection:"column",rowGap:e.space.$4}),children:[t.totals.totalDueNow.amount>0?(0,r.BX)(D.Ph,{elementId:"paymentSource",options:u,value:(null==s?void 0:s.id)||null,onChange:e=>{d(i.find(t=>t.id===e.value))},portal:!0,children:[(0,r.tZ)("input",{name:"payment_source_id",type:"hidden",value:null==s?void 0:s.id}),(0,r.tZ)(D.UN,{icon:$.jC,sx:e=>({justifyContent:"space-between",backgroundColor:e.colors.$colorBackground}),children:s&&(0,r.tZ)(P.j,{paymentSource:s})}),(0,r.tZ)(D.pp,{sx:e=>({paddingBlock:e.space.$1,color:e.colors.$colorText})})]}):(0,r.tZ)("input",{name:"payment_source_id",type:"hidden",value:null==s?void 0:s.id}),(0,r.tZ)(B.Z.Alert,{children:c.error}),(0,r.tZ)(a.Button,{type:"submit",colorScheme:"primary",size:"sm",textVariant:"buttonLarge",sx:{width:"100%"},isLoading:c.isLoading,children:(0,r.tZ)(a.Text,{localizationKey:o.amount>0?(0,a.localizationKeys)("commerce.pay",{amount:"".concat(o.currencySymbol).concat(o.amountFormatted)}):(0,a.localizationKeys)("commerce.subscribe")})})]})});var L=o(9117),N=o(99140);let M=()=>{let{errors:e}=g(),{translateError:t}=(0,a.useLocalizations)(),{t:o}=(0,a.useLocalizations)();return(0,r.tZ)(i.Drawer.Body,{children:(0,r.tZ)(a.Flex,{align:"center",justify:"center",sx:e=>({height:"100%",padding:e.space.$4,fontSize:e.fontSizes.$md}),children:(0,r.tZ)(L.b,{variant:"danger",colorScheme:"danger",children:e?t(e[0]):o((0,a.localizationKeys)("unstable__errors.form_param_value_invalid"))})})})},U=()=>{let{errors:e}=g(),t=(0,l.useMemo)(()=>{var t;let o=null==e?void 0:e.find(e=>"invalid_plan_change"===e.code);return null==o?void 0:null===(t=o.meta)||void 0===t?void 0:t.plan},[e]),{planPeriod:o}=(0,n.useCheckoutContext)();return t?(0,r.tZ)(i.Drawer.Body,{children:(0,r.BX)(a.Flex,{gap:4,direction:"col",children:[(0,r.tZ)(a.Box,{elementDescriptor:a.descriptors.checkoutFormLineItemsRoot,sx:e=>({padding:e.space.$4,borderBottomWidth:e.borderWidths.$normal,borderBottomStyle:e.borderStyles.$solid,borderBottomColor:e.colors.$neutralAlpha100}),children:(0,r.tZ)(c.a.Root,{children:(0,r.BX)(c.a.Group,{children:[(0,r.tZ)(c.a.Title,{title:t.name,description:"annual"===o?(0,a.localizationKeys)("commerce.billedAnnually"):void 0}),(0,r.tZ)(c.a.Description,{prefix:"annual"===o?"x12":void 0,text:"".concat(t.currency_symbol).concat("month"===o?t.amount_formatted:t.annual_monthly_amount_formatted),suffix:(0,a.localizationKeys)("commerce.checkout.perMonth")})]})})}),(0,r.tZ)(a.Box,{sx:e=>({padding:e.space.$4}),children:(0,r.tZ)(L.b,{variant:"info",colorScheme:"info",title:(0,a.localizationKeys)("commerce.cannotSubscribeMonthly")})})]})}):null},G=()=>{let{startCheckout:e}=g(),{setIsOpen:t}=(0,i.useDrawerContext)();return(0,r.tZ)(i.Drawer.Body,{children:(0,r.tZ)(a.Box,{sx:e=>({padding:e.space.$4}),children:(0,r.tZ)(N._,{title:(0,a.localizationKeys)("commerce.checkout.emailForm.title"),subtitle:(0,a.localizationKeys)("commerce.checkout.emailForm.subtitle"),onSuccess:e,onReset:()=>t(!1),disableAutoFocus:!0})})})},Y=e=>(0,r.tZ)(a.Flow.Root,{flow:"checkout",children:(0,r.tZ)(a.Flow.Part,{children:(0,r.tZ)(n.SubscriberTypeContext.Provider,{value:e.subscriberType||"user",children:(0,r.tZ)(n.CheckoutContext.Provider,{value:{componentName:"Checkout",...e},children:(0,r.BX)(i.Drawer.Content,{children:[(0,r.tZ)(i.Drawer.Header,{title:(0,a.localizationKeys)("commerce.checkout.title")}),(0,r.BX)(k,{children:[(0,r.tZ)(x,{name:"pending",children:(0,r.tZ)(a.Spinner,{sx:{margin:"auto"}})}),(0,r.tZ)(x,{name:"completed",children:(0,r.tZ)(Z,{})}),(0,r.tZ)(x,{name:"error",children:(0,r.tZ)(M,{})}),(0,r.tZ)(x,{name:"invalid_plan_change",children:(0,r.tZ)(U,{})}),(0,r.tZ)(x,{name:"missing_payer_email",children:(0,r.tZ)(G,{})}),(0,r.tZ)(x,{name:"ready",children:(0,r.tZ)(R,{})})]})]})})})})})},99140:function(e,t,o){o.d(t,{_:()=>b}),o(92037),o(28419);var r=o(79109),i=o(83799),n=o(69144),a=o(2672),l=o(70431),c=o(19460),s=o(68487),d=o(8969),u=o(11576),m=o(91085),p=o(77623),h=o(10207);o(50725);var y=o(24676),f=o(26917),g=o(39541),v=o(12464);let k=e=>{let{navigate:t}=(0,y.useRouter)(),{email:o,nextStep:i,onReset:l}=e,s=(0,a.useCardState)(),d=(0,u.useUserProfileContext)(),{startEnterpriseSSOLinkFlow:m}=(0,v.eq)(o);async function h(){var e;await t((null===(e=o.verification.externalVerificationRedirectURL)||void 0===e?void 0:e.href)||"")}return n.useEffect(()=>{!function(){let{mode:e,componentName:t}=d;m({redirectUrl:"modal"===e?(0,f.bX)({url:window.location.href,componentName:t}):window.location.href}).then(()=>i()).catch(e=>(0,p.S3)(e,[],s.setError))}()},[]),(0,r.BX)(r.HY,{children:[(0,r.tZ)(g.Flex,{justify:"center",children:(0,r.tZ)(g.Button,{variant:"link",onClick:h,localizationKey:(0,g.localizationKeys)("userProfile.emailAddressPage.enterpriseSSOLink.formButton")})}),(0,r.tZ)(c.K,{children:(0,r.tZ)(g.Button,{variant:"ghost",localizationKey:(0,g.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:g.descriptors.formButtonReset,onClick:l})})]})};var x=o(12786);let b=(0,a.withCardStateProvider)(e=>{var t,o;let{emailId:y,onSuccess:f,onReset:g,disableAutoFocus:v=!1}=e,b=(0,a.useCardState)(),{user:B}=(0,i.aF)(),w=(0,u.useEnvironment)(),C=(0,i.WZ)(e=>null==B?void 0:B.createEmailAddress({email:e})),D=n.useRef(null==B?void 0:B.emailAddresses.find(e=>e.id===y)),_=Z(D.current,w),z=(0,d.a2)({defaultStep:+!!D.current,onNextStep:()=>b.setError(void 0)}),$=(0,p.Yp)("emailAddress","",{type:"email",label:(0,m.u1)("formFieldLabel__emailAddress"),placeholder:(0,m.u1)("formFieldInputPlaceholder__emailAddress"),isRequired:!0}),K=$.value.length>1&&(null==B?void 0:B.username)!==$.value,P=async e=>{if(e.preventDefault(),B)return C($.value).then(e=>{D.current=e,z.nextStep()}).catch(e=>(0,p.S3)(e,[$],b.setError))},A=S(_);return(0,r.BX)(d.en,{...z.props,children:[(0,r.tZ)(s.Y,{headerTitle:e.title||(0,m.u1)("userProfile.emailAddressPage.title"),headerSubtitle:e.subtitle||(0,m.u1)("userProfile.emailAddressPage.formHint"),children:(0,r.BX)(l.l.Root,{onSubmit:P,children:[(0,r.tZ)(l.l.ControlRow,{elementId:$.id,children:(0,r.tZ)(l.l.PlainInput,{...$.props,autoFocus:!v})}),(0,r.tZ)(c.A,{submitLabel:(0,m.u1)("userProfile.formButtonPrimary__add"),isDisabled:!K,onReset:g})]})}),(0,r.BX)(s.Y,{headerTitle:(0,m.u1)("userProfile.emailAddressPage.verifyTitle"),headerSubtitle:(0,m.u1)("".concat(A,".formSubtitle"),{identifier:null===(t=D.current)||void 0===t?void 0:t.emailAddress}),children:["email_link"===_&&(0,r.tZ)(x.K,{nextStep:f,email:D.current,onReset:g}),"email_code"===_&&(0,r.tZ)(h.H,{nextStep:f,identification:D.current,identifier:null===(o=D.current)||void 0===o?void 0:o.emailAddress,prepareVerification:()=>{var e;return null===(e=D.current)||void 0===e?void 0:e.prepareVerification({strategy:"email_code"})},onReset:g}),"enterprise_sso"===_&&(0,r.tZ)(k,{nextStep:f,email:D.current,onReset:g})]})]})}),S=e=>{switch(e){case"email_code":return"userProfile.emailAddressPage.emailCode";case"enterprise_sso":return"userProfile.emailAddressPage.enterpriseSSOLink";case"email_link":return"userProfile.emailAddressPage.emailLink";default:throw Error("Unsupported strategy for email verification: ".concat(e))}},Z=(e,t)=>(null==e?void 0:e.matchesSsoConnection)?"enterprise_sso":!function(e){let{userSettings:t}=e,{email_address:o}=t.attributes;return!!((null==o?void 0:o.enabled)&&(null==o?void 0:o.verifications.includes("email_link")))}(t)?"email_code":"email_link"},10207:function(e,t,o){o.d(t,{H:()=>u});var r=o(79109),i=o(69144),n=o(12667),a=o(2672),l=o(70431),c=o(19460),s=o(39541),d=o(77623);let u=e=>{let t=(0,a.useCardState)(),{nextStep:o,identification:u,identifier:m,onReset:p,prepareVerification:h}=e,y=()=>{var e;return null==h?void 0:null===(e=h())||void 0===e?void 0:e.catch(e=>(0,d.S3)(e,[],t.setError))},f=(0,n.e3)({onCodeEntryFinished:(e,t,o)=>{null==u||u.attemptVerification({code:e}).then(()=>t()).catch(o)},onResendCodeClicked:y,onResolve:o});return i.useEffect(()=>{y()},[]),(0,r.BX)(r.HY,{children:[(0,r.tZ)(l.l.OTPInput,{...f,label:(0,s.localizationKeys)("userProfile.emailAddressPage.emailCode.formTitle"),description:(0,s.localizationKeys)("userProfile.emailAddressPage.emailCode.formSubtitle",{identifier:m}),resendButton:(0,s.localizationKeys)("userProfile.emailAddressPage.emailCode.resendButton"),centerAlign:!1}),(0,r.BX)(c.K,{children:[(0,r.tZ)(s.Button,{isLoading:f.isLoading,localizationKey:(0,s.localizationKeys)("formButtonPrimary__verify"),elementDescriptor:s.descriptors.formButtonPrimary,onClick:f.onFakeContinue}),(0,r.tZ)(s.Button,{variant:"ghost",isDisabled:f.isLoading,localizationKey:(0,s.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:s.descriptors.formButtonReset,onClick:p})]})]})}},12786:function(e,t,o){o.d(t,{K:()=>h,M:()=>y});var r=o(79109),i=o(69144),n=o(2672),a=o(19460),l=o(65495),c=o(8969),s=o(56749),d=o(11576),u=o(39541),m=o(12464),p=o(77623);let h=e=>{let{email:t,nextStep:o,onReset:c}=e,h=(0,n.useCardState)(),y=(0,d.useUserProfileContext)(),{startEmailLinkFlow:f}=(0,m.E2)(t),{displayConfig:g}=(0,d.useEnvironment)();function v(){let{routing:e}=y,t="virtual"===e?g.userProfileUrl:"";f({redirectUrl:(0,s.Uu)({ctx:y,baseUrl:t,intent:"profile"})}).then(()=>o()).catch(e=>(0,p.S3)(e,[],h.setError))}return i.useEffect(()=>{v()},[]),(0,r.BX)(r.HY,{children:[(0,r.tZ)(l.V,{resendButton:(0,u.localizationKeys)("userProfile.emailAddressPage.emailLink.resendButton"),onResendCodeClicked:v}),(0,r.tZ)(a.K,{children:(0,r.tZ)(u.Button,{variant:"ghost",localizationKey:(0,u.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:u.descriptors.formButtonReset,onClick:c})})]})},y=()=>(0,r.tZ)(c.Ej,{title:(0,u.localizationKeys)("signUp.emailLink.verifiedSwitchTab.title"),subtitle:(0,u.localizationKeys)("signUp.emailLink.verifiedSwitchTab.subtitle"),status:"verified"})}}]);