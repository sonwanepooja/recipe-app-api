"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["616"],{52010:function(e,t,i){i.r(t),i.d(t,{APIKeys:()=>L,APIKeysPage:()=>A}),i(50725),i(56113),i(65223);var a=i(79109),l=i(73531),n=i(83799),o=i(69144),r=i(50903),s=i(11576),d=i(39541),c=i(99805),u=i(2672),h=i(81319),p=i(13638),y=i(96519),m=i(81201),x=i(69626),g=i(33009),Z=i(12464),K=i(92156);let v=e=>{let{apiKeyID:t,enabled:i}=e,a=(0,n.cL)();return(0,x.default)(i?["api-key-secret",t]:null,()=>a.apiKeys.getSecret(t))},b=e=>{let{apiKeyID:t}=e,[i,l]=(0,o.useState)(!1),{data:n}=v({apiKeyID:t,enabled:i}),{onCopy:r,hasCopied:s}=(0,Z.VP)(null!=n?n:"");return(0,o.useEffect)(()=>{i&&n&&(r(),l(!1))},[i,n,r]),(0,a.tZ)(d.Button,{variant:"ghost","aria-label":s?"Copied API key to clipboard":"Copy API key",onClick:()=>l(!0),focusRing:!1,children:(0,a.tZ)(d.Icon,{size:"sm",icon:s?y.Jr:y.uU,sx:e=>({color:e.colors.$primary500})})})},f=e=>{let{apiKeyID:t}=e,[i,l]=(0,o.useState)(!1),{data:n}=v({apiKeyID:t,enabled:i});return(0,a.BX)(d.Flex,{center:!0,sx:{width:"100%",position:"relative"},children:[(0,a.tZ)(d.Input,{type:i?"text":"password",value:i&&n?n:"â€¢".repeat(25),readOnly:!0,"aria-label":"API key (hidden)",sx:e=>({paddingInlineEnd:e.sizes.$12})}),(0,a.tZ)(d.Button,{variant:"ghost",sx:e=>({position:"absolute",right:0,"&:focus-visible":{...m.common.focusRingStyles(e)}}),focusRing:!1,"aria-label":"Show key",onClick:()=>l(!i),children:(0,a.tZ)(d.Icon,{icon:i?y.N6:y.bA,sx:e=>({color:e.colors.$colorTextSecondary})})})]})},w=e=>{let{rows:t,isLoading:i,onRevoke:l}=e;return(0,a.tZ)(d.Flex,{sx:e=>({width:"100%",[m.mqu.sm]:{overflowX:"auto",padding:e.space.$0x25}}),children:(0,a.BX)(d.Table,{sx:e=>({background:e.colors.$colorBackground}),children:[(0,a.tZ)(d.Thead,{children:(0,a.BX)(d.Tr,{children:[(0,a.tZ)(d.Th,{children:"Name"}),(0,a.tZ)(d.Th,{children:"Last used"}),(0,a.tZ)(d.Th,{children:"Key"}),(0,a.tZ)(d.Th,{children:"Actions"})]})}),(0,a.tZ)(d.Tbody,{children:i?(0,a.tZ)(d.Tr,{children:(0,a.tZ)(d.Td,{colSpan:4,children:(0,a.tZ)(d.Spinner,{colorScheme:"primary",sx:{margin:"auto",display:"block"},elementDescriptor:d.descriptors.spinner})})}):t.length?t.map(e=>(0,a.BX)(d.Tr,{children:[(0,a.tZ)(d.Td,{children:(0,a.BX)(d.Flex,{direction:"col",sx:{minWidth:"25ch"},children:[(0,a.tZ)(d.Text,{variant:"subtitle",truncate:!0,children:e.name}),(0,a.BX)(d.Text,{variant:"caption",colorScheme:"secondary",children:["Created at"," ",e.createdAt.toLocaleDateString(void 0,{month:"short",day:"2-digit",year:"numeric"})]})]})}),(0,a.tZ)(d.Td,{children:(0,a.tZ)(d.Box,{sx:{[m.mqu.sm]:{minWidth:"10ch"}},children:(0,a.tZ)(d.Text,{localizationKey:e.lastUsedAt?(0,K.S)(e.lastUsedAt):"-"})})}),(0,a.tZ)(d.Td,{children:(0,a.BX)(d.Flex,{direction:"row",gap:1,sx:{[m.mqu.sm]:{minWidth:"25ch"}},children:[(0,a.tZ)(f,{apiKeyID:e.id}),(0,a.tZ)(b,{apiKeyID:e.id})]})}),(0,a.tZ)(d.Td,{children:(0,a.tZ)(g.a,{actions:[{label:(0,d.localizationKeys)("apiKeys.menuAction__revoke"),isDestructive:!0,onClick:()=>l(e.id,e.name)}]})})]},e.id)):(0,a.tZ)(T,{})})]})})},T=()=>(0,a.tZ)(d.Tr,{children:(0,a.tZ)(d.Td,{colSpan:4,children:(0,a.tZ)(d.Text,{localizationKey:(0,d.localizationKeys)("apiKeys.detailsTitle__emptyRow"),sx:{margin:"auto",display:"block",width:"fit-content"}})})});i(92037);var k=i(44709),I=i(70431),B=i(19460),C=i(68487),_=i(47291),S=i(36788);let D=(e,t)=>{if("never"===e)return;let i=new Date,a=new Date(i);switch(e){case"30d":a.setDate(a.getDate()+30);break;case"90d":a.setDate(a.getDate()+90);break;case"custom":a=new Date(t);break;default:throw Error("Invalid expiration option")}return Math.floor((a.getTime()-i.getTime())/1e3)},z=()=>{let e=new Date;return e.setDate(e.getDate()+1),e.toISOString().split("T")[0]},F=e=>{let{onCreate:t,isSubmitting:i}=e,[l,n]=(0,o.useState)(!1),[r,s]=(0,o.useState)("never"),c=o.useId(),u="".concat(c,"-segmented-control"),{close:h}=(0,k.XC)(),p=(0,S.Yp)("name","",{type:"text",label:(0,d.localizationKeys)("formFieldLabel__apiKeyName"),placeholder:(0,d.localizationKeys)("formFieldInputPlaceholder__apiKeyName"),isRequired:!0}),y=(0,S.Yp)("apiKeyDescription","",{type:"text",label:(0,d.localizationKeys)("formFieldLabel__apiKeyDescription"),placeholder:(0,d.localizationKeys)("formFieldInputPlaceholder__apiKeyDescription"),isRequired:!1}),x=(0,S.Yp)("apiKeyExpirationDate","",{type:"date",label:(0,d.localizationKeys)("formFieldLabel__apiKeyExpirationDate"),placeholder:(0,d.localizationKeys)("formFieldInputPlaceholder__apiKeyExpirationDate"),isRequired:!1}),g=p.value.length>2;return(0,a.tZ)(C.Y,{headerTitle:(0,d.localizationKeys)("apiKeys.formTitle"),headerSubtitle:(0,d.localizationKeys)("apiKeys.formHint"),children:(0,a.BX)(I.l.Root,{onSubmit:e=>{e.preventDefault(),t({name:p.value,description:y.value||void 0,expiration:D(r,x.value)},h)},children:[(0,a.tZ)(I.l.ControlRow,{elementId:p.id,children:(0,a.tZ)(I.l.PlainInput,{...p.props})}),l&&(0,a.BX)(a.HY,{children:[(0,a.tZ)(I.l.ControlRow,{elementId:y.id,children:(0,a.tZ)(I.l.PlainInput,{...y.props})}),(0,a.BX)(d.Flex,{gap:4,sx:{[m.mqu.sm]:{flexDirection:"column"}},children:[(0,a.BX)(d.Col,{gap:2,sx:{flex:7},children:[(0,a.tZ)(d.FormLabel,{htmlFor:u,children:(0,a.tZ)(d.Text,{as:"span",variant:"subtitle",localizationKey:(0,d.localizationKeys)("formFieldLabel__apiKeyExpiration")})}),(0,a.BX)(_.s.Root,{"aria-labelledby":u,value:r,onChange:e=>s(e),fullWidth:!0,sx:e=>({height:e.sizes.$8}),children:[(0,a.tZ)(_.s.Button,{value:"never",text:"Never"}),(0,a.tZ)(_.s.Button,{value:"30d",text:"30 days"}),(0,a.tZ)(_.s.Button,{value:"90d",text:"90 days"}),(0,a.tZ)(_.s.Button,{value:"custom",text:"Custom"})]})]}),"custom"===r?(0,a.tZ)(I.l.ControlRow,{elementId:x.id,sx:{flex:3},children:(0,a.tZ)(I.l.PlainInput,{type:"date",...x.props,min:z()})}):(0,a.tZ)(d.Box,{sx:{flex:3,visibility:"hidden"}})]})]}),(0,a.BX)(d.Flex,{justify:"between",align:"center",gap:4,sx:{[m.mqu.sm]:{flexDirection:"column",alignItems:"stretch"}},children:[(0,a.BX)(d.Button,{variant:"outline",onClick:()=>n(e=>!e),children:[l?"Hide":"Show"," advanced settings"]}),(0,a.tZ)(B.A,{submitLabel:(0,d.localizationKeys)("apiKeys.formButtonPrimary__add"),isDisabled:!g,onReset:h,isLoading:i})]})]})})};i(28419);let P=e=>{let{subject:t,perPage:i=5}=e,a=(0,n.cL)(),l={key:"api-keys",subject:t},{data:r,isLoading:s,mutate:d}=(0,x.default)(l,()=>a.apiKeys.getAll({subject:t})),[c,u]=(0,o.useState)(""),{page:h,setPage:p,pageCount:y,itemCount:m,startingRow:g,endingRow:Z,paginatedItems:K}=R((null!=r?r:[]).filter(e=>e.name.toLowerCase().includes(c.toLowerCase())),i);return{apiKeys:K,cacheKey:l,mutate:d,isLoading:s,search:c,setSearch:u,page:h,setPage:p,pageCount:y,itemCount:m,startingRow:g,endingRow:Z}},R=(e,t)=>{let[i,a]=(0,o.useState)(1),l=e.length,n=Math.max(1,Math.ceil(l/t)),r=l>0?(i-1)*t+1:0,s=Math.min(i*t,l),d=e.slice(r-1,s);return{page:i,setPage:a,pageCount:n,itemCount:l,startingRow:r,endingRow:s,paginatedItems:d}},X=(0,o.lazy)(()=>i.e("642").then(i.bind(i,3250)).then(e=>({default:e.RevokeAPIKeyConfirmationModal}))),A=e=>{let{subject:t,perPage:i,revokeModalRoot:s}=e,{apiKeys:x,isLoading:g,search:Z,setSearch:K,page:v,setPage:b,pageCount:f,itemCount:T,startingRow:k,endingRow:I,cacheKey:B}=P({subject:t,perPage:i}),C=(0,u.useCardState)(),{trigger:_,isMutating:S}=(0,r.Z)(B,(e,t)=>{let{arg:i}=t;return z.apiKeys.create(i)}),{t:D}=(0,d.useLocalizations)(),z=(0,n.cL)(),[R,A]=(0,o.useState)(!1),[L,q]=(0,o.useState)(""),[E,$]=(0,o.useState)(""),j=async(e,i)=>{try{await _({...e,subject:t}),i(),C.setError(void 0)}catch(e){(0,l.kD)(e)&&409===e.status&&C.setError("API Key name already exists")}};return(0,a.BX)(d.Col,{gap:4,sx:{width:"100%"},children:[(0,a.BX)(c.a.Root,{children:[(0,a.BX)(d.Flex,{justify:"between",align:"center",gap:4,sx:{[m.mqu.sm]:{flexDirection:"column",alignItems:"stretch"}},children:[(0,a.tZ)(d.Box,{children:(0,a.tZ)(h.W,{placeholder:D((0,d.localizationKeys)("apiKeys.action__search")),leftIcon:(0,a.tZ)(d.Icon,{icon:y.Yt}),value:Z,onChange:e=>{K(e.target.value),b(1)}})}),(0,a.tZ)(c.a.Trigger,{value:"add-api-key",hideOnActive:!1,children:(0,a.tZ)(d.Button,{variant:"solid",localizationKey:(0,d.localizationKeys)("apiKeys.action__add")})})]}),(0,a.tZ)(c.a.Open,{value:"add-api-key",children:(0,a.tZ)(d.Flex,{sx:e=>({paddingTop:e.space.$6,paddingBottom:e.space.$6}),children:(0,a.tZ)(c.a.Card,{sx:{width:"100%"},children:(0,a.tZ)(F,{onCreate:j,isSubmitting:S})})})})]}),(0,a.tZ)(w,{rows:x,isLoading:g,onRevoke:(e,t)=>{q(e),$(t),A(!0)}}),T>(null!=i?i:5)&&(0,a.tZ)(p.t,{count:f,page:v,onChange:b,siblingCount:1,rowInfo:{allRowsCount:T,startingRow:k,endingRow:I}}),(0,a.tZ)(X,{subject:t,isOpen:R,onOpen:()=>A(!0),onClose:()=>{q(""),$(""),A(!1)},apiKeyId:L,apiKeyName:E,modalRoot:s})]})},L=(0,s.withCoreUserGuard)((0,u.withCardStateProvider)(()=>{var e,t;let i=(0,s.useApiKeysContext)(),{user:l}=(0,n.aF)(),{organization:o}=(0,n.o8)(),r=null!==(t=null!==(e=null==o?void 0:o.id)&&void 0!==e?e:null==l?void 0:l.id)&&void 0!==t?t:"";return(0,a.tZ)(d.Flow.Root,{flow:"apiKeys",sx:{width:"100%"},children:(0,a.tZ)(A,{subject:r,perPage:i.perPage})})}))}}]);